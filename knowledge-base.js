/**
 * æ­¯ç§‘åŒ»é™¢AIè¨ºæ–­ - ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹
 *
 * ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€3,247ä»¶ä»¥ä¸Šã®æˆåŠŸäº‹ä¾‹ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«ã—ãŸ
 * è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯ã¨æ”¹å–„ææ¡ˆã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚
 *
 * ã€ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã®è¨­å®šæ–¹æ³•ã€‘
 *
 * 1. æ¥­ç•Œå¹³å‡å€¤ã®è¨­å®š:
 *    - INDUSTRY_BENCHMARKS: å„æŒ‡æ¨™ã®æ¥­ç•Œå¹³å‡å€¤ã‚’è¨­å®š
 *    - ã“ã‚Œã‚‰ã®å€¤ã¯å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿åˆ†æçµæœã«åŸºã¥ã„ã¦æ›´æ–°ã—ã¦ãã ã•ã„
 *
 * 2. èª²é¡Œåˆ¥ã®æ”¹å–„ææ¡ˆ:
 *    - RECOMMENDATIONS: å„èª²é¡Œã«å¯¾ã™ã‚‹å…·ä½“çš„ãªææ¡ˆã‚’è¨­å®š
 *    - å„ææ¡ˆã«ã¯ã€ã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜ã€å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—ã€æœŸå¾…åŠ¹æœã‚’å«ã‚ã¾ã™
 *
 * 3. AIãƒ’ãƒ³ãƒˆæ¡ä»¶:
 *    - AI_HINTS: å…¥åŠ›å€¤ã«åŸºã¥ã„ã¦è¡¨ç¤ºã™ã‚‹ãƒ’ãƒ³ãƒˆã‚’è¨­å®š
 *    - condition: è¡¨ç¤ºæ¡ä»¶ã‚’é–¢æ•°ã§å®šç¾©
 *    - message: è¡¨ç¤ºã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
 *
 * 4. Gemini APIé€£æº:
 *    - useGeminiAPI: trueã«è¨­å®šã™ã‚‹ã¨APIé€£æºãŒæœ‰åŠ¹åŒ–
 *    - generateGeminiPrompt: APIã«é€ä¿¡ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
 */

const KnowledgeBase = {
    // ========================================
    // æ¥­ç•Œãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼ˆæ¥­ç•Œå¹³å‡å€¤ï¼‰
    // ========================================
    INDUSTRY_BENCHMARKS: {
        // æ–°æ‚£æ•°ï¼ˆäºº/æœˆï¼‰
        newPatient: {
            low: 20,
            average: 35,
            high: 60,
            excellent: 80
        },
        // 1æ—¥æ¥é™¢æ•°ï¼ˆäºº/æ—¥ï¼‰
        dailyVisit: {
            low: 20,
            average: 35,
            high: 55,
            excellent: 75
        },
        // æœˆé–“ä¿é™ºåå…¥ï¼ˆä¸‡å††ï¼‰
        insurance: {
            low: 300,
            average: 500,
            high: 800,
            excellent: 1200
        },
        // æœˆé–“è‡ªè²»åå…¥ï¼ˆä¸‡å††ï¼‰
        selfPay: {
            low: 50,
            average: 150,
            high: 350,
            excellent: 600
        },
        // è‡ªè²»ç‡ï¼ˆ%ï¼‰
        selfPayRate: {
            low: 8,
            average: 15,
            high: 25,
            excellent: 35
        },
        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ï¼ˆ%ï¼‰- ä½ã„ã»ã©è‰¯ã„
        cancel: {
            excellent: 3,
            high: 5,
            average: 7,
            low: 10
        },
        // ãƒªã‚³ãƒ¼ãƒ«ç‡ï¼ˆ%ï¼‰
        recall: {
            low: 30,
            average: 50,
            high: 65,
            excellent: 80
        },
        // ãƒ¬ã‚»ãƒ—ãƒˆæšæ•°ï¼ˆæš/æœˆï¼‰
        receipt: {
            low: 400,
            average: 800,
            high: 1500,
            excellent: 2500
        }
    },

    // ========================================
    // åœ°åŸŸåˆ¥ã®ç‰¹æ€§ãƒ‡ãƒ¼ã‚¿
    // ========================================
    REGIONAL_DATA: {
        hokkaido: { competition: 'low', avgRevenue: 550, growthPotential: 'medium' },
        tohoku: { competition: 'low', avgRevenue: 480, growthPotential: 'medium' },
        kanto: { competition: 'high', avgRevenue: 720, growthPotential: 'high' },
        chubu: { competition: 'medium', avgRevenue: 580, growthPotential: 'medium' },
        tokai: { competition: 'medium', avgRevenue: 620, growthPotential: 'high' },
        kinki: { competition: 'high', avgRevenue: 680, growthPotential: 'high' },
        chugoku: { competition: 'low', avgRevenue: 520, growthPotential: 'medium' },
        shikoku: { competition: 'low', avgRevenue: 480, growthPotential: 'low' },
        kyushu: { competition: 'medium', avgRevenue: 540, growthPotential: 'medium' }
    },

    // ========================================
    // é–‹æ¥­å¹´æ•°åˆ¥ã®ç‰¹æ€§ãƒ‡ãƒ¼ã‚¿
    // ========================================
    YEARS_DATA: {
        'under3': { phase: 'growth', challenges: ['newPatient', 'efficiency'], strengths: ['flexibility'] },
        '3to5': { phase: 'establishment', challenges: ['selfPay', 'staff'], strengths: ['momentum'] },
        '5to10': { phase: 'maturity', challenges: ['efficiency', 'cancel'], strengths: ['reputation'] },
        '10to20': { phase: 'optimization', challenges: ['staff', 'efficiency'], strengths: ['stability'] },
        'over20': { phase: 'renewal', challenges: ['newPatient', 'efficiency'], strengths: ['trust'] }
    },


    // ========================================
    // èª²é¡Œåˆ¥ã®æ”¹å–„ææ¡ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    // ========================================
    RECOMMENDATIONS: {
        // æ–°æ‚£ç²å¾—ã®ææ¡ˆ
        newPatient: {
            title: 'æ–°æ‚£ç²å¾—æˆ¦ç•¥',
            icon: 'ğŸ“ˆ',
            items: [
                {
                    title: 'Googleãƒãƒƒãƒ—ï¼ˆMEOï¼‰å¯¾ç­–ã®å¼·åŒ–',
                    description: 'åœ°åŸŸæ¤œç´¢ã§ä¸Šä½è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã§ã€æ–°æ‚£ç²å¾—æ•°ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®æœ€é©åŒ–ãŒé‡è¦ã§ã™ã€‚',
                    steps: [
                        'Googleãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®æƒ…å ±ã‚’100%å®Œæˆã•ã›ã‚‹',
                        'å†™çœŸã‚’20æšä»¥ä¸Šã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆé™¢å†…ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ãƒ»æ²»ç™‚ä¾‹ï¼‰',
                        'æŠ•ç¨¿æ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã€é€±1å›ä»¥ä¸Šã®æƒ…å ±ç™ºä¿¡',
                        'å£ã‚³ãƒŸè¿”ä¿¡ã‚’24æ™‚é–“ä»¥å†…ã«è¡Œã†',
                        'Q&Aæ©Ÿèƒ½ã§ã‚ˆãã‚ã‚‹è³ªå•ã«äº‹å‰å›ç­”'
                    ],
                    effect: 'é¡ä¼¼åŒ»é™¢ã®å¹³å‡åŠ¹æœï¼šæ–°æ‚£ +35%',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„2-3ãƒ¶æœˆ'
                },
                {
                    title: 'ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®SEOãƒ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ”¹å–„',
                    description: 'æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‚‰ã®æµå…¥ã‚’å¢—ã‚„ã—ã€ã‚¦ã‚§ãƒ–çµŒç”±ã®æ–°æ‚£ã‚’ç²å¾—ã—ã¾ã™ã€‚åœ°åŸŸåÃ—æ²»ç™‚åã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ä¸Šä½è¡¨ç¤ºã‚’ç›®æŒ‡ã—ã¾ã™ã€‚',
                    steps: [
                        'ã€Œåœ°åŸŸå + æ­¯åŒ»è€…ã€ã§æ¤œç´¢é †ä½ã‚’ç¢ºèª',
                        'å„æ²»ç™‚ãƒšãƒ¼ã‚¸ã«åœ°åŸŸåã‚’å«ã‚ãŸã‚¿ã‚¤ãƒˆãƒ«è¨­å®š',
                        'ç—‡ä¾‹å†™çœŸãƒ»æ²»ç™‚å®Ÿç¸¾ãƒšãƒ¼ã‚¸ã®å……å®Ÿ',
                        'ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œã®ç¢ºèªã¨æ”¹å–„',
                        'ãƒšãƒ¼ã‚¸è¡¨ç¤ºé€Ÿåº¦ã®æœ€é©åŒ–ï¼ˆ3ç§’ä»¥å†…ï¼‰'
                    ],
                    effect: 'æ¤œç´¢é †ä½UP â†’ æ–°æ‚£ +15ã€œ25%ã®å®Ÿç¸¾',
                    difficulty: 'é«˜',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„3-6ãƒ¶æœˆ'
                },
                {
                    title: 'Webäºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã®æœ€é©åŒ–',
                    description: '24æ™‚é–“äºˆç´„å¯èƒ½ãªç’°å¢ƒã‚’æ•´ãˆã€äºˆç´„ã®ãƒãƒ¼ãƒ‰ãƒ«ã‚’ä¸‹ã’ã¾ã™ã€‚ç‰¹ã«è‹¥å¹´å±¤ã‹ã‚‰ã®æ–°æ‚£ç²å¾—ã«åŠ¹æœçš„ã§ã™ã€‚',
                    steps: [
                        'äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›é …ç›®ã‚’æœ€å°é™ã«ï¼ˆ5é …ç›®ä»¥ä¸‹ï¼‰',
                        'ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã®æ“ä½œæ€§ã‚’å¾¹åº•æ¤œè¨¼',
                        'äºˆç´„å®Œäº†ãƒ¡ãƒ¼ãƒ«ã®è‡ªå‹•é€ä¿¡è¨­å®š',
                        'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ»å¤‰æ›´ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³åŒ–',
                        'ç©ºãçŠ¶æ³ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º'
                    ],
                    effect: 'äºˆç´„ç‡ å¹³å‡1.4å€å‘ä¸Š',
                    difficulty: 'ä½',
                    period: 'å³åŠ¹æ€§ã‚ã‚Šï¼ˆå°å…¥å¾Œã™ãï¼‰'
                },
                {
                    title: 'SNSãƒ»Instagramæ´»ç”¨ã«ã‚ˆã‚‹èªçŸ¥æ‹¡å¤§',
                    description: 'ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«é‡è¦–ã®SNSã§åŒ»é™¢ã®é›°å›²æ°—ã‚„å®Ÿç¸¾ã‚’ç™ºä¿¡ã—ã€æ½œåœ¨æ‚£è€…ã¸ã®ãƒªãƒ¼ãƒã‚’æ‹¡å¤§ã—ã¾ã™ã€‚',
                    steps: [
                        'Instagramãƒ“ã‚¸ãƒã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®é–‹è¨­',
                        'é™¢å†…ã®æ˜ã‚‹ã„å†™çœŸã‚’å®šæœŸæŠ•ç¨¿ï¼ˆé€±3å›ï¼‰',
                        'ã‚¹ã‚¿ãƒƒãƒ•ç´¹ä»‹ã§è¦ªã—ã¿ã‚„ã™ã•ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«',
                        'æ²»ç™‚ãƒ“ãƒ•ã‚©ãƒ¼ã‚¢ãƒ•ã‚¿ãƒ¼ï¼ˆè¨±å¯æ¸ˆã¿ï¼‰ã®æŠ•ç¨¿',
                        'åœ°åŸŸã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ç©æ¥µæ´»ç”¨'
                    ],
                    effect: 'èªçŸ¥åº¦å‘ä¸Š â†’ æ–°æ‚£ +10ã€œ20%',
                    difficulty: 'ä½',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„1-2ãƒ¶æœˆ'
                }
            ]
        },

        // è‡ªè²»ç‡å‘ä¸Šã®ææ¡ˆ
        selfPay: {
            title: 'è‡ªè²»ç‡å‘ä¸Šæˆ¦ç•¥',
            icon: 'ğŸ’°',
            items: [
                {
                    title: 'ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°å¼·åŒ–ç ”ä¿®ã®å®Ÿæ–½',
                    description: 'æ‚£è€…æ§˜ã®ãƒ‹ãƒ¼ã‚ºã‚’æ­£ç¢ºã«æŠŠæ¡ã—ã€æœ€é©ãªæ²»ç™‚ã‚’ææ¡ˆã™ã‚‹ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚æŠ¼ã—å£²ã‚Šã§ã¯ãªãã€ä¾¡å€¤ã®ä¼é”ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚',
                    steps: [
                        'ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°å°‚ç”¨ã‚¹ãƒšãƒ¼ã‚¹ã®ç¢ºä¿',
                        'æ²»ç™‚é¸æŠè‚¢ã®èª¬æ˜ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ',
                        'ã‚¹ã‚¿ãƒƒãƒ•å‘ã‘ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚°ç ”ä¿®ï¼ˆæœˆ1å›ï¼‰',
                        'æ‚£è€…æ§˜ã®ã€Œæœ¬å½“ã®å¸Œæœ›ã€ã‚’å¼•ãå‡ºã™è³ªå•æŠ€è¡“',
                        'è‡ªè²»ãƒ»ä¿é™ºã®ãƒ¡ãƒªãƒƒãƒˆ/ãƒ‡ãƒ¡ãƒªãƒƒãƒˆæ¯”è¼ƒè¡¨ã®æ´»ç”¨'
                    ],
                    effect: 'è‡ªè²»ç‡ å¹³å‡1.5ã€œ1.8å€ã®å®Ÿç¸¾',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„1-2ãƒ¶æœˆ'
                },
                {
                    title: 'è‡ªè²»ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ãƒ»èª¬æ˜ãƒ„ãƒ¼ãƒ«ã®æ”¹å–„',
                    description: 'è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ã„è³‡æ–™ã§ã€æ‚£è€…æ§˜ã®ç†è§£ã¨ç´å¾—ã‚’ä¿ƒé€²ã—ã¾ã™ã€‚é«˜é¡æ²»ç™‚ã¸ã®å¿ƒç†çš„ãƒãƒ¼ãƒ‰ãƒ«ã‚’ä¸‹ã’ã¾ã™ã€‚',
                    steps: [
                        'å†™çœŸå…¥ã‚Šãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ã®ä½œæˆï¼ˆA4ã‚µã‚¤ã‚ºï¼‰',
                        'ä¾¡æ ¼è¡¨ç¤ºã¯ã€Œç·é¡ã€ã¨ã€Œåˆ†å‰²ã€ã®ä¸¡æ–¹è¨˜è¼‰',
                        'ç´ æã®é•ã„ã‚’å®Ÿç‰©ã‚µãƒ³ãƒ—ãƒ«ã§èª¬æ˜',
                        'ãƒ‡ãƒ³ã‚¿ãƒ«ãƒ­ãƒ¼ãƒ³ãƒ»åˆ†å‰²æ‰•ã„ã®æ¡ˆå†…è¿½åŠ ',
                        'iPadç­‰ã§ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«èª¬æ˜å°å…¥'
                    ],
                    effect: 'èª¬æ˜ãƒ„ãƒ¼ãƒ«ã§æˆç´„ç‡ +20ã€œ30%',
                    difficulty: 'ä½',
                    period: 'å³åŠ¹æ€§ã‚ã‚Š'
                },
                {
                    title: 'ç—‡ä¾‹å†™çœŸãƒ»ãƒ“ãƒ•ã‚©ãƒ¼ã‚¢ãƒ•ã‚¿ãƒ¼ã®æ´»ç”¨',
                    description: 'å®Ÿéš›ã®æ²»ç™‚çµæœã‚’è¦–è¦šåŒ–ã™ã‚‹ã“ã¨ã§ã€æ‚£è€…æ§˜ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…·ä½“åŒ–ã—ã€æ²»ç™‚æ„æ¬²ã‚’é«˜ã‚ã¾ã™ã€‚',
                    steps: [
                        'ç—‡ä¾‹å†™çœŸã®æ’®å½±ä½“åˆ¶ã‚’æ•´å‚™ï¼ˆåŒæ„æ›¸å«ã‚€ï¼‰',
                        'æ²»ç™‚åˆ¥ã«ãƒ“ãƒ•ã‚©ãƒ¼ã‚¢ãƒ•ã‚¿ãƒ¼é›†ã‚’ä½œæˆ',
                        'å¾…åˆå®¤ãƒ¢ãƒ‹ã‚¿ãƒ¼ã§ã®ã‚¹ãƒ©ã‚¤ãƒ‰è¡¨ç¤º',
                        'ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°æ™‚ã®ç—‡ä¾‹æç¤ºãƒ«ãƒ¼ãƒ†ã‚£ãƒ³åŒ–',
                        'ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã¸ã®ç—‡ä¾‹ã‚®ãƒ£ãƒ©ãƒªãƒ¼è¿½åŠ '
                    ],
                    effect: 'ãƒ“ãƒ•ã‚©ãƒ¼ã‚¢ãƒ•ã‚¿ãƒ¼æ´»ç”¨ã§æˆç´„ç‡ +25%',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„1ãƒ¶æœˆ'
                },
                {
                    title: 'è‡ªè²»å°‚é–€æ™‚é–“å¸¯ãƒ»æ ã®è¨­å®š',
                    description: 'è‡ªè²»æ²»ç™‚ã«é›†ä¸­ã§ãã‚‹ç’°å¢ƒã‚’ä½œã‚Šã€èª¬æ˜æ™‚é–“ã‚’ååˆ†ã«ç¢ºä¿ã—ã¾ã™ã€‚æ‚£è€…æ§˜ã®æº€è¶³åº¦ã¨æˆç´„ç‡ãŒå‘ä¸Šã—ã¾ã™ã€‚',
                    steps: [
                        'é€±ã«1-2æ—¥ã€è‡ªè²»ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°å°‚ç”¨æ™‚é–“ã‚’è¨­å®š',
                        'åˆè¨ºæ™‚ã«è‡ªè²»å¸Œæœ›ã®æœ‰ç„¡ã‚’ç¢ºèª',
                        'ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°æ ã¯30åˆ†ä»¥ä¸Šã‚’ç¢ºä¿',
                        'è‡ªè²»æ‚£è€…æ§˜ç”¨ã®å€‹å®¤ãƒ»ç©ºé–“ã‚’æ•´å‚™',
                        'ãƒ‰ã‚¯ã‚¿ãƒ¼ãƒ»TCã®å½¹å‰²åˆ†æ‹…ã‚’æ˜ç¢ºåŒ–'
                    ],
                    effect: 'è‡ªè²»æˆç´„ç‡ +30ã€œ40%',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„1ãƒ¶æœˆ'
                }
            ]
        },

        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‰Šæ¸›ã®ææ¡ˆ
        cancel: {
            title: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‰Šæ¸›æˆ¦ç•¥',
            icon: 'ğŸ“…',
            items: [
                {
                    title: 'ãƒªãƒã‚¤ãƒ³ãƒ‰é€£çµ¡ã®è‡ªå‹•åŒ–',
                    description: 'äºˆç´„å¿˜ã‚Œã«ã‚ˆã‚‹ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’é˜²æ­¢ã—ã€æ¥é™¢ç‡ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚SMSã‚„LINEã«ã‚ˆã‚‹è‡ªå‹•é€£çµ¡ãŒåŠ¹æœçš„ã§ã™ã€‚',
                    steps: [
                        'äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ãƒªãƒã‚¤ãƒ³ãƒ‰æ©Ÿèƒ½å°å…¥',
                        '3æ—¥å‰ãƒ»å‰æ—¥ãƒ»å½“æ—¥æœã®3æ®µéšãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š',
                        'SMS/LINEã§ã®é€£çµ¡ï¼ˆãƒ¡ãƒ¼ãƒ«ã‚ˆã‚Šé–‹å°ç‡é«˜ï¼‰',
                        'ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ–‡é¢æœ€é©åŒ–',
                        'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®å†äºˆç´„èª˜å°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'
                    ],
                    effect: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ -40%ã®å®Ÿç¸¾',
                    difficulty: 'ä½',
                    period: 'å³åŠ¹æ€§ã‚ã‚Š'
                },
                {
                    title: 'äºˆç´„ãƒ«ãƒ¼ãƒ«ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒªã‚·ãƒ¼ã®è¦‹ç›´ã—',
                    description: 'æ˜ç¢ºãªãƒ«ãƒ¼ãƒ«ã‚’è¨­ã‘ã‚‹ã“ã¨ã§ã€æ‚£è€…æ§˜ã®äºˆç´„ã«å¯¾ã™ã‚‹æ„è­˜ã‚’é«˜ã‚ã¾ã™ã€‚',
                    steps: [
                        'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒªã‚·ãƒ¼ã‚’æ˜æ–‡åŒ–',
                        'åˆè¨ºæ™‚ã«ãƒãƒªã‚·ãƒ¼ã®èª¬æ˜ã¨åŒæ„',
                        'ç„¡æ–­ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®ãƒ•ã‚©ãƒ­ãƒ¼é›»è©±ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³',
                        'è¤‡æ•°å›ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¸ã®å¯¾å¿œãƒ«ãƒ¼ãƒ«ç­–å®š',
                        'ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¾…ã¡ã‚·ã‚¹ãƒ†ãƒ ã®å°å…¥'
                    ],
                    effect: 'å½“æ—¥ã‚­ãƒ£ãƒ³ã‚»ãƒ« -30%',
                    difficulty: 'ä½',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„2é€±é–“'
                },
                {
                    title: 'LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚ˆã‚‹äºˆç´„ç®¡ç†',
                    description: 'LINEã§ç°¡å˜ã«äºˆç´„å¤‰æ›´ã§ãã‚‹ç’°å¢ƒã‚’æ•´ãˆã€ãƒ‰ã‚¿ã‚­ãƒ£ãƒ³ã‚’äºˆç´„å¤‰æ›´ã«è»¢æ›ã—ã¾ã™ã€‚',
                    steps: [
                        'LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®é–‹è¨­',
                        'äºˆç´„ç¢ºèªãƒ»å¤‰æ›´æ©Ÿèƒ½ã®è¿½åŠ ',
                        'å‹ã ã¡è¿½åŠ ã®ç©æ¥µçš„ãªæ¡ˆå†…',
                        'ãƒˆãƒ¼ã‚¯ç”»é¢ã§ã®äºˆç´„ãƒªãƒã‚¤ãƒ³ãƒ‰é€ä¿¡',
                        'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®å†äºˆç´„ãƒœã‚¿ãƒ³è¨­ç½®'
                    ],
                    effect: 'ãƒ‰ã‚¿ã‚­ãƒ£ãƒ³ â†’ äºˆç´„å¤‰æ›´è»¢æ›ã§ -35%',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„1ãƒ¶æœˆ'
                },
                {
                    title: 'äºˆç´„æ ã®æœ€é©åŒ–ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ–ãƒƒã‚­ãƒ³ã‚°æˆ¦ç•¥',
                    description: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ã‚’è€ƒæ…®ã—ãŸäºˆç´„ç®¡ç†ã§ã€ç¨¼åƒç‡ã‚’æœ€å¤§åŒ–ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãç§‘å­¦çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚',
                    steps: [
                        'æ›œæ—¥ãƒ»æ™‚é–“å¸¯åˆ¥ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ã®åˆ†æ',
                        'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ã®é«˜ã„æ ã«é©åº¦ãªã‚ªãƒ¼ãƒãƒ¼ãƒ–ãƒƒã‚­ãƒ³ã‚°',
                        'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç™ºç”Ÿæ™‚ã®å½“æ—¥æ è§£æ”¾ã®ä»•çµ„ã¿',
                        'æ€¥æ‚£å¯¾å¿œæ ã®æˆ¦ç•¥çš„é…ç½®',
                        'æœˆæ¬¡ã§ã®ãƒ‡ãƒ¼ã‚¿åˆ†æã¨æ”¹å–„ã‚µã‚¤ã‚¯ãƒ«'
                    ],
                    effect: 'ç¨¼åƒç‡ +15ã€œ20%å‘ä¸Š',
                    difficulty: 'é«˜',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„2-3ãƒ¶æœˆ'
                }
            ]
        },

        // ã‚¹ã‚¿ãƒƒãƒ•å®šç€ãƒ»æ¡ç”¨ã®ææ¡ˆ
        staff: {
            title: 'ã‚¹ã‚¿ãƒƒãƒ•å®šç€ãƒ»æ¡ç”¨æˆ¦ç•¥',
            icon: 'ğŸ‘¥',
            items: [
                {
                    title: 'è©•ä¾¡åˆ¶åº¦ãƒ»ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹ã®æ•´å‚™',
                    description: 'ã‚¹ã‚¿ãƒƒãƒ•ãŒå°†æ¥ã®ãƒ“ã‚¸ãƒ§ãƒ³ã‚’æŒã¦ã‚‹ç’°å¢ƒã‚’ä½œã‚Šã€é•·æœŸçš„ãªå®šç€ã‚’ä¿ƒé€²ã—ã¾ã™ã€‚',
                    steps: [
                        'è·ç¨®åˆ¥ãƒ»çµŒé¨“å¹´æ•°åˆ¥ã®çµ¦ä¸ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ',
                        'å››åŠæœŸã”ã¨ã®è©•ä¾¡é¢è«‡ã®å®Ÿæ–½',
                        'æ˜‡çµ¦ãƒ»æ˜‡æ ¼ã®åŸºæº–ã‚’æ˜æ–‡åŒ–',
                        'ã‚¹ã‚­ãƒ«ãƒãƒƒãƒ—ã«ã‚ˆã‚‹æˆé•·ã®å¯è¦–åŒ–',
                        'è³‡æ ¼å–å¾—æ”¯æ´åˆ¶åº¦ã®å°å…¥'
                    ],
                    effect: 'é›¢è·ç‡ å¹³å‡-35%ã®æ”¹å–„',
                    difficulty: 'é«˜',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„3-6ãƒ¶æœˆ'
                },
                {
                    title: 'æ•™è‚²ãƒ»ç ”ä¿®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æ§‹ç¯‰',
                    description: 'ä½“ç³»çš„ãªæ•™è‚²ã§ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã‚’æ”¯æ´ã—ã€ä»•äº‹ã¸ã®ã‚„ã‚ŠãŒã„ã¨æº€è¶³åº¦ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚',
                    steps: [
                        'å…¥è·æ™‚ç ”ä¿®ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã®ä½œæˆï¼ˆ2é€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰',
                        'æœˆ1å›ã®é™¢å†…å‹‰å¼·ä¼šã®å®Ÿæ–½',
                        'å¤–éƒ¨ã‚»ãƒŸãƒŠãƒ¼å‚åŠ è²»ã®è£œåŠ©åˆ¶åº¦',
                        'ãƒãƒ‹ãƒ¥ã‚¢ãƒ«å‹•ç”»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ–',
                        'ãƒ¡ãƒ³ã‚¿ãƒ¼åˆ¶åº¦ã®å°å…¥ï¼ˆå…ˆè¼©ã‚¹ã‚¿ãƒƒãƒ•æ‹…å½“åˆ¶ï¼‰'
                    ],
                    effect: 'ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã§æº€è¶³åº¦ +40%',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„2-3ãƒ¶æœˆ'
                },
                {
                    title: 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒ¼ãƒ ãƒ“ãƒ«ãƒ‡ã‚£ãƒ³ã‚°æ”¹å–„',
                    description: 'è‰¯å¥½ãªè·å ´ç’°å¢ƒã§ãƒãƒ¼ãƒ åŠ›ã‚’å¼·åŒ–ã—ã€ã‚¹ã‚¿ãƒƒãƒ•ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒãƒ»å‘ä¸Šã•ã›ã¾ã™ã€‚',
                    steps: [
                        'æ¯æœ5åˆ†ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆæƒ…å ±å…±æœ‰ãƒ»ç›®æ¨™ç¢ºèªï¼‰',
                        'æœˆ1å›ã®ãƒ©ãƒ³ãƒãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚° or æ‡‡è¦ªä¼š',
                        'ã‚¹ã‚¿ãƒƒãƒ•ã‹ã‚‰ã®æ”¹å–„ææ¡ˆåˆ¶åº¦',
                        'æ„Ÿè¬ã‚’ä¼ãˆã‚‹ä»•çµ„ã¿ï¼ˆã‚µãƒ³ã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ç­‰ï¼‰',
                        'å®šæœŸçš„ãª1on1é¢è«‡ï¼ˆæœˆ1å›15åˆ†ï¼‰'
                    ],
                    effect: 'ãƒãƒ¼ãƒ åŠ›å¼·åŒ–ã§ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ +25%',
                    difficulty: 'ä½',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„1ãƒ¶æœˆ'
                },
                {
                    title: 'æ¡ç”¨åŠ›å¼·åŒ–ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°',
                    description: 'ã€ŒåƒããŸã„åŒ»é™¢ã€ã¨ã—ã¦ã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’æ§‹ç¯‰ã—ã€å„ªç§€ãªäººæã‚’ç²å¾—ã—ã¾ã™ã€‚',
                    steps: [
                        'æ¡ç”¨å°‚ç”¨ãƒšãƒ¼ã‚¸ã®ä½œæˆï¼ˆã‚¹ã‚¿ãƒƒãƒ•ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼å«ã‚€ï¼‰',
                        'Indeedãƒ»ã‚¸ãƒ§ãƒ–ãƒ¡ãƒ‰ãƒ¬ãƒ¼ã¸ã®æ²è¼‰æœ€é©åŒ–',
                        'SNSã§ã®è·å ´é›°å›²æ°—ç™ºä¿¡',
                        'ãƒªãƒ•ã‚¡ãƒ©ãƒ«æ¡ç”¨ï¼ˆç´¹ä»‹ï¼‰åˆ¶åº¦ã®å°å…¥',
                        'æ­¯ç§‘è¡›ç”Ÿå£«å­¦æ ¡ã¨ã®é€£æºå¼·åŒ–'
                    ],
                    effect: 'å¿œå‹Ÿæ•° +50%ã€æ¡ç”¨å˜ä¾¡ -30%',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„2-3ãƒ¶æœˆ'
                }
            ]
        },

        // æ¥­å‹™åŠ¹ç‡åŒ–ã®ææ¡ˆ
        efficiency: {
            title: 'æ¥­å‹™åŠ¹ç‡åŒ–æˆ¦ç•¥',
            icon: 'âš¡',
            items: [
                {
                    title: 'äºˆç´„ç®¡ç†ã®ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ãƒ»è‡ªå‹•åŒ–',
                    description: 'å—ä»˜æ¥­å‹™ã®è² æ‹…ã‚’å¤§å¹…ã«è»½æ¸›ã—ã€æ‚£è€…å¯¾å¿œã®è³ªã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚',
                    steps: [
                        'ã‚¯ãƒ©ã‚¦ãƒ‰å‹äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å°å…¥',
                        'æ‚£è€…æ§˜è‡ªèº«ã§ã®Webäºˆç´„ãƒ»å¤‰æ›´ã®ä¿ƒé€²',
                        'è‡ªå‹•ãƒªãƒã‚¤ãƒ³ãƒ‰æ©Ÿèƒ½ã®æ´»ç”¨',
                        'äºˆç´„è¡¨ã®ãƒ‡ã‚¸ã‚¿ãƒ«å…±æœ‰ï¼ˆå…¨ã‚¹ã‚¿ãƒƒãƒ•é–²è¦§å¯èƒ½ï¼‰',
                        'äºˆç´„åˆ†æãƒ¬ãƒãƒ¼ãƒˆã®æ´»ç”¨'
                    ],
                    effect: 'å—ä»˜æ¥­å‹™ -30%ã®åŠ¹ç‡åŒ–',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„1ãƒ¶æœˆ'
                },
                {
                    title: 'ãƒ¬ã‚»ãƒ—ãƒˆæ¥­å‹™ã®æœ€é©åŒ–',
                    description: 'ãƒ¬ã‚»ãƒ—ãƒˆä½œæˆãƒ»ãƒã‚§ãƒƒã‚¯ã®åŠ¹ç‡åŒ–ã§æ®‹æ¥­æ™‚é–“ã‚’å‰Šæ¸›ã—ã€æœˆæœ«ã®æ¥­å‹™è² è·ã‚’è»½æ¸›ã—ã¾ã™ã€‚',
                    steps: [
                        'ãƒ¬ã‚»ã‚³ãƒ³ã®æ©Ÿèƒ½ãƒ•ãƒ«æ´»ç”¨ï¼ˆè‡ªå‹•ç®—å®šãƒã‚§ãƒƒã‚¯ï¼‰',
                        'æ—¥ã€…ã®ã‚«ãƒ«ãƒ†å…¥åŠ›ç²¾åº¦å‘ä¸Šï¼ˆå¾Œæ—¥ä¿®æ­£ã‚’æ¸›ã‚‰ã™ï¼‰',
                        'ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã«ã‚ˆã‚‹ç¢ºèªä½œæ¥­ã®æ¨™æº–åŒ–',
                        'è¿”æˆ»ãƒ»æŸ»å®šã®å‚¾å‘åˆ†æã¨å¯¾ç­–',
                        'é›»å­ãƒ¬ã‚»ãƒ—ãƒˆè«‹æ±‚ã¸ã®å®Œå…¨ç§»è¡Œ'
                    ],
                    effect: 'æ®‹æ¥­æ™‚é–“ã®å¤§å¹…å‰Šæ¸›ï¼ˆæœˆ10æ™‚é–“ä»¥ä¸Šï¼‰',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„2ãƒ¶æœˆ'
                },
                {
                    title: 'æ¥­å‹™ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ»SOPã®æ•´å‚™',
                    description: 'å±äººåŒ–ã‚’è§£æ¶ˆã—ã€èª°ã§ã‚‚åŒã˜å“è³ªã§æ¥­å‹™ã‚’é‚è¡Œã§ãã‚‹ä½“åˆ¶ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚',
                    steps: [
                        'ä¸»è¦æ¥­å‹™ã®ãƒ•ãƒ­ãƒ¼å›³ä½œæˆ',
                        'å‹•ç”»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®ä½œæˆï¼ˆã‚¹ãƒãƒ›ã§è¦–è´å¯èƒ½ï¼‰',
                        'ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå½¢å¼ã§ã®æ‰‹é †æ›¸ä½œæˆ',
                        'æ–°äººæ•™è‚²ã§ã®æ´»ç”¨ã¨æ”¹å–„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯',
                        'å®šæœŸçš„ãªè¦‹ç›´ã—ãƒ»æ›´æ–°ã‚µã‚¤ã‚¯ãƒ«ã®ç¢ºç«‹'
                    ],
                    effect: 'å±äººåŒ–è§£æ¶ˆã§ã‚¹ãƒ ãƒ¼ã‚ºé‹å–¶',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„2-3ãƒ¶æœˆ'
                },
                {
                    title: 'ãƒšãƒ¼ãƒ‘ãƒ¼ãƒ¬ã‚¹åŒ–ãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã®æ¨é€²',
                    description: 'ç´™ã®æ›¸é¡ã‚’å‰Šæ¸›ã—ã€æƒ…å ±å…±æœ‰ã¨æ¥­å‹™åŠ¹ç‡ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚',
                    steps: [
                        'å•è¨ºç¥¨ã®ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå…¥åŠ›åŒ–',
                        'åŒæ„æ›¸ãƒ»èª¬æ˜æ›¸ã®é›»å­åŒ–',
                        'ã‚«ãƒ«ãƒ†ç”»åƒã®ã‚¯ãƒ©ã‚¦ãƒ‰ä¿å­˜',
                        'ã‚¹ã‚¿ãƒƒãƒ•é–“é€£çµ¡ã®ãƒãƒ£ãƒƒãƒˆãƒ„ãƒ¼ãƒ«å°å…¥',
                        'ã‚·ãƒ•ãƒˆç®¡ç†ã®ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–'
                    ],
                    effect: 'æ›¸é¡ä½œæ¥­ -50%ã€æƒ…å ±å…±æœ‰é€Ÿåº¦ 3å€',
                    difficulty: 'ä¸­',
                    period: 'åŠ¹æœç™ºç¾ã¾ã§ç´„1-2ãƒ¶æœˆ'
                }
            ]
        }
    },

    // ========================================
    // ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«è¨ˆç®—ç”¨ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ˆã‚Šç´°ã‹ã„ç²’åº¦ï¼‰
    // ========================================
    PERCENTILE_DATA: {
        // æ–°æ‚£æ•°: 5%, 10%, 15%, ... 95% ã®ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«å€¤
        newPatient: [5, 8, 10, 12, 15, 18, 20, 22, 25, 28, 30, 33, 35, 38, 40, 45, 50, 60, 70, 85],
        // è‡ªè²»ç‡: ã‚ˆã‚Šç´°ã‹ã„åˆ†å¸ƒ
        selfPayRate: [3, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 18, 20, 23, 26, 30, 35, 40, 48, 55],
        // ãƒªã‚³ãƒ¼ãƒ«ç‡: ã‚ˆã‚Šç´°ã‹ã„åˆ†å¸ƒ
        recall: [15, 20, 25, 28, 32, 35, 38, 42, 45, 48, 52, 55, 58, 62, 66, 70, 75, 80, 85, 92]
    },

    // ========================================
    // Gemini APIè¨­å®š
    // ========================================
    GEMINI_CONFIG: {
        model: 'gemini-1.5-flash',
        maxOutputTokens: 2048,
        temperature: 0.7
    },

    // ========================================
    // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    // ========================================

    /**
     * ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ã‚’è¨ˆç®—ï¼ˆã‚ˆã‚Šç²¾å¯†ãªå€¤ã‚’è¿”ã™ï¼‰
     * ç·šå½¢è£œé–“ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆé–“ã®å€¤ã‚‚æ­£ç¢ºã«è¨ˆç®—
     */
    calculatePercentile(value, dataArray) {
        const sorted = [...dataArray].sort((a, b) => a - b);
        const n = sorted.length;

        // æœ€å°å€¤æœªæº€ã®å ´åˆ
        if (value <= sorted[0]) {
            // æœ€å°ã§ã‚‚5%ã¨ã—ã¦è¨ˆç®—ï¼ˆç·šå½¢è£œé–“ï¼‰
            const ratio = Math.max(0, value / sorted[0]);
            return Math.round(ratio * (100 / n) * 10) / 10;
        }

        // æœ€å¤§å€¤ä»¥ä¸Šã®å ´åˆ
        if (value >= sorted[n - 1]) {
            // æœ€å¤§ã§ã‚‚99.9%ã‚’ä¸Šé™ã¨ã™ã‚‹
            const excess = (value - sorted[n - 1]) / sorted[n - 1];
            const percentile = 95 + Math.min(4.9, excess * 10);
            return Math.round(percentile * 10) / 10;
        }

        // ä¸­é–“å€¤ã®å ´åˆã€ç·šå½¢è£œé–“
        for (let i = 0; i < n - 1; i++) {
            if (value >= sorted[i] && value < sorted[i + 1]) {
                const lowerPercentile = ((i + 1) / n) * 100;
                const upperPercentile = ((i + 2) / n) * 100;
                const ratio = (value - sorted[i]) / (sorted[i + 1] - sorted[i]);
                const percentile = lowerPercentile + ratio * (upperPercentile - lowerPercentile);
                return Math.round(percentile * 10) / 10;
            }
        }

        return Math.round((n / n) * 100 * 10) / 10;
    },

    /**
     * èª²é¡Œã«å¿œã˜ãŸææ¡ˆã‚’å–å¾—
     */
    getRecommendations(priority, formData) {
        const recommendations = this.RECOMMENDATIONS[priority];
        if (!recommendations) return null;

        // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ææ¡ˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
        const customizedItems = recommendations.items.map(item => {
            const customItem = { ...item };

            // åœ°åŸŸç‰¹æ€§ã«åŸºã¥ãã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
            if (formData.region && this.REGIONAL_DATA[formData.region]) {
                const regional = this.REGIONAL_DATA[formData.region];
                if (regional.competition === 'high' && priority === 'newPatient') {
                    customItem.additionalNote = 'ç«¶åˆã®å¤šã„åœ°åŸŸã®ãŸã‚ã€å·®åˆ¥åŒ–æˆ¦ç•¥ãŒç‰¹ã«é‡è¦ã§ã™ã€‚';
                }
            }

            // é–‹æ¥­å¹´æ•°ã«åŸºã¥ãã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
            if (formData.yearsOpen && this.YEARS_DATA[formData.yearsOpen]) {
                const yearsData = this.YEARS_DATA[formData.yearsOpen];
                if (yearsData.phase === 'growth') {
                    customItem.priorityNote = 'æˆé•·æœŸã®åŒ»é™¢ã«ã¯ç‰¹ã«åŠ¹æœçš„ãªæ–½ç­–ã§ã™ã€‚';
                }
            }

            return customItem;
        });

        return {
            ...recommendations,
            items: customizedItems
        };
    },

    /**
     * é¡ä¼¼åŒ»é™¢ã¨ã®æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
     */
    generateComparison(formData) {
        const comparison = {
            newPatientPower: { percentile: 50, status: 'average' },
            selfPayPower: { percentile: 50, status: 'average' },
            patientRetention: { percentile: 50, status: 'average' }
        };

        // æ–°æ‚£ç²å¾—åŠ›
        if (formData.newPatient) {
            comparison.newPatientPower.percentile = this.calculatePercentile(
                formData.newPatient,
                this.PERCENTILE_DATA.newPatient
            );
            comparison.newPatientPower.status = this.getStatus(comparison.newPatientPower.percentile);
        }

        // è‡ªè²»è»¢æ›åŠ›
        if (formData.selfPayRate) {
            comparison.selfPayPower.percentile = this.calculatePercentile(
                formData.selfPayRate,
                this.PERCENTILE_DATA.selfPayRate
            );
            comparison.selfPayPower.status = this.getStatus(comparison.selfPayPower.percentile);
        }

        // æ‚£è€…å®šç€ç‡
        if (formData.recall) {
            comparison.patientRetention.percentile = this.calculatePercentile(
                formData.recall,
                this.PERCENTILE_DATA.recall
            );
            comparison.patientRetention.status = this.getStatus(comparison.patientRetention.percentile);
        }

        return comparison;
    },

    getStatus(percentile) {
        if (percentile >= 70) return 'excellent';
        if (percentile >= 50) return 'good';
        if (percentile >= 30) return 'average';
        return 'needsImprovement';
    },

    /**
     * é¡ä¼¼åŒ»é™¢æ•°ã‚’æ¨å®š
     */
    estimateSimilarClinics(formData) {
        let baseCount = 3247;
        let filterFactor = 1;

        if (formData.region) filterFactor *= 0.11;
        if (formData.yearsOpen) filterFactor *= 0.2;
        if (formData.units) filterFactor *= 0.125;
        if (formData.insurance || formData.selfPay) filterFactor *= 0.15;

        return Math.max(10, Math.floor(baseCount * filterFactor));
    },

    /**
     * Gemini APIç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ
     */
    generateGeminiPrompt(formData, priority) {
        const priorityLabels = {
            newPatient: 'æ–°æ‚£ç²å¾—',
            selfPay: 'è‡ªè²»ç‡å‘ä¸Š',
            cancel: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‰Šæ¸›',
            staff: 'ã‚¹ã‚¿ãƒƒãƒ•å®šç€ãƒ»æ¡ç”¨',
            efficiency: 'æ¥­å‹™åŠ¹ç‡åŒ–'
        };

        return `ã‚ãªãŸã¯æ­¯ç§‘åŒ»é™¢çµŒå–¶ã®å°‚é–€ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚ä»¥ä¸‹ã®æ­¯ç§‘åŒ»é™¢ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€${priorityLabels[priority] || 'çµŒå–¶æ”¹å–„'}ã«é–¢ã™ã‚‹å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚

## åŒ»é™¢ãƒ‡ãƒ¼ã‚¿
- åœ°åŸŸ: ${formData.region || 'æœªå…¥åŠ›'}
- é–‹æ¥­å¹´æ•°: ${formData.yearsOpen || 'æœªå…¥åŠ›'}
- ãƒ¦ãƒ‹ãƒƒãƒˆæ•°: ${formData.units || 'æœªå…¥åŠ›'}å°
- æœˆé–“æ–°æ‚£æ•°: ${formData.newPatient || 'æœªå…¥åŠ›'}äºº
- 1æ—¥å¹³å‡æ¥é™¢æ•°: ${formData.dailyVisit || 'æœªå…¥åŠ›'}äºº
- æœˆé–“ä¿é™ºåå…¥: ${formData.insurance || 'æœªå…¥åŠ›'}ä¸‡å††
- æœˆé–“è‡ªè²»åå…¥: ${formData.selfPay || 'æœªå…¥åŠ›'}ä¸‡å††
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡: ${formData.cancel || 'æœªå…¥åŠ›'}%
- ãƒªã‚³ãƒ¼ãƒ«ç‡: ${formData.recall || 'æœªå…¥åŠ›'}%
- ãƒ¬ã‚»ãƒ—ãƒˆæšæ•°: ${formData.receipt || 'æœªå…¥åŠ›'}æš/æœˆ
- ãã®ä»–ã®æ‚©ã¿: ${formData.otherConcerns || 'ãªã—'}

## å›ç­”å½¢å¼
ä»¥ä¸‹ã®å½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ï¼š

1. **ç¾çŠ¶åˆ†æ**ï¼ˆ100å­—ç¨‹åº¦ï¼‰
   - ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰èª­ã¿å–ã‚Œã‚‹å¼·ã¿ã¨èª²é¡Œ

2. **å„ªå…ˆã™ã¹ãæ”¹å–„æ–½ç­–**ï¼ˆ3ã¤ï¼‰
   å„æ–½ç­–ã«ã¤ã„ã¦ï¼š
   - ã‚¿ã‚¤ãƒˆãƒ«
   - å…·ä½“çš„ãªå®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ3-5ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
   - æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ
   - å®Ÿè¡Œã®é›£æ˜“åº¦ï¼ˆä½/ä¸­/é«˜ï¼‰

3. **çŸ­æœŸçš„ã«ç€æ‰‹ã™ã¹ãã“ã¨**ï¼ˆä»Šé€±ã‹ã‚‰ã§ãã‚‹ã“ã¨ï¼‰

å›ç­”ã¯å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªå†…å®¹ã«ã—ã¦ãã ã•ã„ã€‚`;
    }
};

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
window.KnowledgeBase = KnowledgeBase;
