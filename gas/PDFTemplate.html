<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>AI診断アドバイスシート</title>
  <style>
    /* PDF用スタイル */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans JP', 'Hiragino Sans', 'Yu Gothic', sans-serif;
      font-size: 11pt;
      line-height: 1.6;
      color: #333;
      background: #fff;
    }

    .container {
      max-width: 210mm;
      margin: 0 auto;
      padding: 15mm;
    }

    /* ヘッダー */
    .header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 3px solid #0D3B66;
    }

    .header h1 {
      font-size: 20pt;
      color: #0D3B66;
      margin-bottom: 5px;
    }

    .header .subtitle {
      font-size: 11pt;
      color: #666;
    }

    .header .date {
      font-size: 10pt;
      color: #888;
      margin-top: 10px;
    }

    /* クリニック情報 */
    .clinic-info {
      background: linear-gradient(135deg, #0D3B66 0%, #1a5490 100%);
      color: #fff;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .clinic-info h2 {
      font-size: 14pt;
      margin-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.3);
      padding-bottom: 8px;
    }

    .clinic-info .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .clinic-info .info-item {
      font-size: 10pt;
    }

    .clinic-info .info-label {
      opacity: 0.8;
    }

    /* セクション */
    .section {
      margin-bottom: 25px;
    }

    .section-title {
      font-size: 14pt;
      color: #0D3B66;
      padding: 8px 15px;
      background: #f0f7ff;
      border-left: 4px solid #0D3B66;
      margin-bottom: 15px;
    }

    /* 診断サマリー */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .summary-card {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 12px;
      text-align: center;
      border: 1px solid #e0e0e0;
    }

    .summary-card .value {
      font-size: 18pt;
      font-weight: bold;
      color: #0D3B66;
    }

    .summary-card .label {
      font-size: 9pt;
      color: #666;
      margin-top: 3px;
    }

    .summary-card .comparison {
      font-size: 8pt;
      margin-top: 5px;
      padding: 2px 6px;
      border-radius: 10px;
    }

    .comparison.up {
      background: #d4edda;
      color: #155724;
    }

    .comparison.down {
      background: #f8d7da;
      color: #721c24;
    }

    .comparison.neutral {
      background: #fff3cd;
      color: #856404;
    }

    /* 最優先課題 */
    .priority-box {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
      color: #fff;
      padding: 15px 20px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 20px;
    }

    .priority-box .label {
      font-size: 10pt;
      opacity: 0.9;
    }

    .priority-box .value {
      font-size: 16pt;
      font-weight: bold;
      margin-top: 5px;
    }

    /* 改善提案 */
    .recommendation-list {
      list-style: none;
    }

    .recommendation-item {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 12px;
    }

    .recommendation-item h4 {
      font-size: 12pt;
      color: #0D3B66;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }

    .recommendation-item h4::before {
      content: "✓";
      display: inline-block;
      width: 20px;
      height: 20px;
      background: #0D3B66;
      color: #fff;
      border-radius: 50%;
      text-align: center;
      line-height: 20px;
      font-size: 10pt;
      margin-right: 10px;
    }

    .recommendation-item p {
      font-size: 10pt;
      color: #555;
      margin-bottom: 10px;
    }

    .recommendation-steps {
      background: #f8f9fa;
      padding: 10px 15px;
      border-radius: 5px;
      margin-top: 10px;
    }

    .recommendation-steps h5 {
      font-size: 10pt;
      color: #333;
      margin-bottom: 8px;
    }

    .recommendation-steps ol {
      margin-left: 20px;
      font-size: 9pt;
      color: #666;
    }

    .recommendation-steps li {
      margin-bottom: 4px;
    }

    .recommendation-effect {
      display: inline-block;
      background: #e8f5e9;
      color: #2e7d32;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 9pt;
      margin-top: 10px;
    }

    /* アクションプラン */
    .action-plan {
      background: #fffde7;
      border: 2px solid #ffc107;
      border-radius: 8px;
      padding: 20px;
    }

    .action-plan h3 {
      font-size: 13pt;
      color: #f57f17;
      margin-bottom: 15px;
      text-align: center;
    }

    .action-timeline {
      position: relative;
      padding-left: 30px;
    }

    .action-timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #ffc107;
    }

    .timeline-item {
      position: relative;
      margin-bottom: 15px;
      padding-left: 15px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -24px;
      top: 5px;
      width: 12px;
      height: 12px;
      background: #ffc107;
      border-radius: 50%;
    }

    .timeline-item .period {
      font-size: 10pt;
      font-weight: bold;
      color: #f57f17;
    }

    .timeline-item .task {
      font-size: 10pt;
      color: #333;
      margin-top: 3px;
    }

    /* CTA */
    .cta-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      margin-top: 25px;
    }

    .cta-section h3 {
      font-size: 14pt;
      margin-bottom: 10px;
    }

    .cta-section p {
      font-size: 10pt;
      opacity: 0.9;
      margin-bottom: 15px;
    }

    .cta-box {
      background: rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: 5px;
    }

    .cta-box .label {
      font-size: 9pt;
      opacity: 0.8;
    }

    .cta-box .value {
      font-size: 12pt;
      font-weight: bold;
      margin-top: 5px;
    }

    /* フッター */
    .footer {
      margin-top: 30px;
      padding-top: 15px;
      border-top: 1px solid #ddd;
      text-align: center;
      font-size: 9pt;
      color: #888;
    }

    .footer .company {
      font-weight: bold;
      color: #0D3B66;
      margin-bottom: 5px;
    }

    /* 印刷用調整 */
    @media print {
      body {
        print-color-adjust: exact;
        -webkit-print-color-adjust: exact;
      }

      .container {
        padding: 10mm;
      }

      .recommendation-item,
      .section {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ヘッダー -->
    <header class="header">
      <h1>AI診断 アドバイスシート</h1>
      <p class="subtitle">歯科医院地域一番実践会 - 3,247件の成功事例に基づく診断結果</p>
      <p class="date">診断日: <?= diagnosisDate ?></p>
    </header>

    <!-- クリニック情報 -->
    <div class="clinic-info">
      <h2><?= data.clinicName || '医院名未入力' ?> 様</h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">ご担当者:</span>
          <?= data.userName || '-' ?> 様
        </div>
        <div class="info-item">
          <span class="info-label">地域:</span>
          <?= getRegionName(data.region) ?>
        </div>
        <div class="info-item">
          <span class="info-label">開業年数:</span>
          <?= getYearsOpenName(data.yearsOpen) ?>
        </div>
        <div class="info-item">
          <span class="info-label">ユニット数:</span>
          <?= data.units || '-' ?> 台
        </div>
      </div>
    </div>

    <!-- 診断サマリー -->
    <section class="section">
      <h3 class="section-title">診断サマリー</h3>
      <div class="summary-grid">
        <? if (data.newPatient) { ?>
        <div class="summary-card">
          <div class="value"><?= data.newPatient ?></div>
          <div class="label">新患数/月</div>
          <? if (comparison.newPatient) { ?>
          <div class="comparison <?= comparison.newPatient.vsAverage >= 0 ? 'up' : 'down' ?>">
            業界平均比 <?= comparison.newPatient.vsAverage >= 0 ? '+' : '' ?><?= comparison.newPatient.vsAverage ?>%
          </div>
          <? } ?>
        </div>
        <? } ?>

        <? if (data.totalRevenue) { ?>
        <div class="summary-card">
          <div class="value"><?= data.totalRevenue ?></div>
          <div class="label">月商（万円）</div>
          <? if (comparison.totalRevenue) { ?>
          <div class="comparison <?= comparison.totalRevenue.vsAverage >= 0 ? 'up' : 'down' ?>">
            業界平均比 <?= comparison.totalRevenue.vsAverage >= 0 ? '+' : '' ?><?= comparison.totalRevenue.vsAverage ?>%
          </div>
          <? } ?>
        </div>
        <? } ?>

        <? if (data.selfPayRate) { ?>
        <div class="summary-card">
          <div class="value"><?= data.selfPayRate ?>%</div>
          <div class="label">自費率</div>
          <? if (comparison.selfPayRate) { ?>
          <div class="comparison <?= comparison.selfPayRate.vsAverage >= 0 ? 'up' : 'down' ?>">
            業界平均比 <?= comparison.selfPayRate.vsAverage >= 0 ? '+' : '' ?><?= comparison.selfPayRate.vsAverage ?>%
          </div>
          <? } ?>
        </div>
        <? } ?>

        <? if (data.cancel) { ?>
        <div class="summary-card">
          <div class="value"><?= data.cancel ?>%</div>
          <div class="label">キャンセル率</div>
          <? if (comparison.cancel) { ?>
          <div class="comparison <?= comparison.cancel.vsAverage >= 0 ? 'up' : 'down' ?>">
            業界平均比 <?= comparison.cancel.vsAverage >= 0 ? '+' : '' ?><?= comparison.cancel.vsAverage ?>%
          </div>
          <? } ?>
        </div>
        <? } ?>
      </div>

      <!-- 最優先課題 -->
      <div class="priority-box">
        <div class="label">あなたの最優先課題</div>
        <div class="value"><?= getPriorityName(data.priority) ?></div>
      </div>
    </section>

    <!-- 改善提案 -->
    <section class="section">
      <h3 class="section-title">具体的な改善提案</h3>
      <ul class="recommendation-list">
        <? var recs = recommendations; ?>
        <? if (recs && recs.items) { ?>
          <? for (var i = 0; i < Math.min(recs.items.length, 4); i++) { ?>
            <? var item = recs.items[i]; ?>
            <? if (typeof item === 'string') { ?>
            <li class="recommendation-item">
              <h4><?= item ?></h4>
            </li>
            <? } else { ?>
            <li class="recommendation-item">
              <h4><?= item.title || item ?></h4>
              <? if (item.description) { ?>
              <p><?= item.description ?></p>
              <? } ?>
              <? if (item.steps && item.steps.length > 0) { ?>
              <div class="recommendation-steps">
                <h5>実行ステップ</h5>
                <ol>
                  <? for (var j = 0; j < Math.min(item.steps.length, 5); j++) { ?>
                  <li><?= item.steps[j] ?></li>
                  <? } ?>
                </ol>
              </div>
              <? } ?>
              <? if (item.effect) { ?>
              <span class="recommendation-effect"><?= item.effect ?></span>
              <? } ?>
            </li>
            <? } ?>
          <? } ?>
        <? } else { ?>
        <li class="recommendation-item">
          <h4>診断結果に基づく改善提案</h4>
          <p>詳細な分析結果については、無料相談にてご説明いたします。</p>
        </li>
        <? } ?>
      </ul>
    </section>

    <!-- アクションプラン -->
    <section class="section">
      <div class="action-plan">
        <h3>推奨アクションプラン</h3>
        <div class="action-timeline">
          <div class="timeline-item">
            <div class="period">今すぐ</div>
            <div class="task">無料相談のご予約 - 診断結果の詳細解説</div>
          </div>
          <div class="timeline-item">
            <div class="period">1週間以内</div>
            <div class="task">現状の課題を院内で共有・優先順位の確認</div>
          </div>
          <div class="timeline-item">
            <div class="period">1ヶ月以内</div>
            <div class="task">最優先課題への取り組み開始</div>
          </div>
          <div class="timeline-item">
            <div class="period">3ヶ月後</div>
            <div class="task">効果測定・次のステップへ</div>
          </div>
        </div>
      </div>
    </section>

    <!-- その他のお悩み -->
    <? if (data.otherConcerns) { ?>
    <section class="section">
      <h3 class="section-title">ご記入いただいたお悩み</h3>
      <p style="padding: 15px; background: #f8f9fa; border-radius: 5px; font-size: 10pt;">
        <?= data.otherConcerns ?>
      </p>
    </section>
    <? } ?>

    <!-- CTA -->
    <div class="cta-section">
      <h3>次のステップ：無料相談のご案内</h3>
      <p>診断結果について、より詳しくご説明させていただきます。<br>具体的な改善プランをご一緒に作成しましょう。</p>
      <div class="cta-box">
        <div class="label">無料相談のご予約</div>
        <div class="value">下記メールアドレスまでご連絡ください</div>
      </div>
    </div>

    <!-- フッター -->
    <footer class="footer">
      <p class="company">歯科医院地域一番実践会</p>
      <p>このアドバイスシートは、AI診断システムにより自動生成されました。</p>
      <p>内容についてのご質問は、お気軽にお問い合わせください。</p>
    </footer>
  </div>

  <script>
    // PDF生成用のヘルパー関数（サーバーサイドでも使用）
    function getRegionName(code) {
      const regions = {
        'hokkaido': '北海道',
        'tohoku': '東北',
        'kanto': '関東',
        'chubu': '中部',
        'tokai': '東海',
        'kinki': '近畿',
        'chugoku': '中国',
        'shikoku': '四国',
        'kyushu': '九州・沖縄'
      };
      return regions[code] || code || '未選択';
    }

    function getYearsOpenName(code) {
      const years = {
        'under3': '3年未満',
        '3to5': '3〜5年',
        '5to10': '5〜10年',
        '10to20': '10〜20年',
        'over20': '20年以上'
      };
      return years[code] || code || '未選択';
    }

    function getPriorityName(code) {
      const priorities = {
        'newPatient': '新患獲得',
        'selfPay': '自費率向上',
        'cancel': 'キャンセル対策',
        'staff': 'スタッフ採用・定着',
        'efficiency': '業務効率化'
      };
      return priorities[code] || code || '未選択';
    }
  </script>
</body>
</html>
